<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Content Management - PickToCart</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root {
            --primary: #00356E;
            --primary-light: #0059B3;
            --secondary: #FF6B35;
            --accent: #00A896;
            --light: #f8f9fa;
            --dark: #343a40;
            --gray: #6c757d;
            --light-gray: #e9ecef;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }

        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            padding: 20px 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .header-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 24px;
            font-weight: 700;
        }

        .nav-links {
            display: flex;
            gap: 25px;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 600;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: var(--secondary);
        }

        .dashboard-container {
            max-width: 1200px;
            margin: 40px auto;
            padding: 0 20px;
        }

        .dashboard-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid var(--light-gray);
        }

        .tab-button {
            padding: 12px 24px;
            background: none;
            border: none;
            font-size: 16px;
            font-weight: 600;
            color: var(--gray);
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab-button.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content {
            display: none;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary);
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--light-gray);
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary);
        }

        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-input {
            display: flex;
            flex-direction: column;
        }

        .btn {
            padding: 12px 24px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            background: var(--primary-light);
        }

        .btn-success {
            background: var(--accent);
        }

        .btn-success:hover {
            background: #008a7a;
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-secondary {
            background: var(--gray);
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .status-message {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .team-member {
            background: var(--light-gray);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid var(--primary);
        }

        .team-member h4 {
            color: var(--primary);
            margin-bottom: 10px;
        }

        .team-member-actions {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }

        .team-form {
            background: var(--light);
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 25px;
            border: 2px dashed var(--primary-light);
        }

        .team-form h3 {
            color: var(--primary);
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-container">
            <div class="logo">
                <i class="fas fa-laptop-code"></i>
                <span>PickToCart - Content Management</span>
            </div>
            <div class="nav-links">
                <a href="dashboard.html">Dashboard</a>
                <a href="#" id="logout-btn">Logout</a>
            </div>
        </div>
    </div>

    <!-- Dashboard Content -->
    <div class="dashboard-container">
        <div class="loading" id="loading-spinner">
            <div class="spinner"></div>
        </div>

        <div id="content" style="display: none;">
            <div class="dashboard-tabs">
                <button class="tab-button active" data-tab="about">About Us</button>
                <button class="tab-button" data-tab="terms">Terms & Conditions</button>
                <button class="tab-button" data-tab="team">Team Members</button>
            </div>

            <!-- Status Messages -->
            <div id="statusMessage" class="status-message"></div>

            <!-- About Us Tab -->
            <div id="about-tab" class="tab-content active">
                <h2>About Us Content Management</h2>
                <form id="about-form">
                    <div class="form-group">
                        <label for="hero_title">Hero Title</label>
                        <input type="text" id="hero_title" name="hero_title" required>
                    </div>

                    <div class="form-group">
                        <label for="hero_description">Hero Description</label>
                        <textarea id="hero_description" name="hero_description" required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="our_story">Our Story</label>
                        <textarea id="our_story" name="our_story" required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="what_we_do">What We Do</label>
                        <textarea id="what_we_do" name="what_we_do" required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="our_values">Our Values</label>
                        <textarea id="our_values" name="our_values" required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="contact_section">Contact Section</label>
                        <textarea id="contact_section" name="contact_section" required></textarea>
                    </div>

                    <h3>Statistics</h3>
                    <div class="stats-grid">
                        <div class="stat-input">
                            <label>Products Available</label>
                            <input type="text" id="stat_products" name="stat_products">
                        </div>
                        <div class="stat-input">
                            <label>Customer Satisfaction</label>
                            <input type="text" id="stat_satisfaction" name="stat_satisfaction">
                        </div>
                        <div class="stat-input">
                            <label>Delivery Cost</label>
                            <input type="text" id="stat_delivery" name="stat_delivery">
                        </div>
                        <div class="stat-input">
                            <label>Delivery Coverage</label>
                            <input type="text" id="stat_coverage" name="stat_coverage">
                        </div>
                    </div>

                    <button type="submit" class="btn btn-success">Update About Us</button>
                </form>
            </div>

            <!-- Terms & Conditions Tab -->
            <div id="terms-tab" class="tab-content">
                <h2>Terms & Conditions Management</h2>
                <form id="terms-form">
                    <div class="form-group">
                        <label for="last_updated">Last Updated</label>
                        <input type="date" id="last_updated" name="last_updated" required>
                    </div>

                    <div class="form-group">
                        <label for="introduction">Introduction</label>
                        <textarea id="introduction" name="introduction" required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="orders_payments">Orders & Payments</label>
                        <textarea id="orders_payments" name="orders_payments" required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="shipping_delivery">Shipping & Delivery</label>
                        <textarea id="shipping_delivery" name="shipping_delivery" required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="returns_refunds">Returns & Refunds</label>
                        <textarea id="returns_refunds" name="returns_refunds" required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="non_returnable_items">Non-Returnable Items</label>
                        <textarea id="non_returnable_items" name="non_returnable_items" required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="exchanges">Exchanges</label>
                        <textarea id="exchanges" name="exchanges" required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="privacy_data_protection">Privacy & Data Protection</label>
                        <textarea id="privacy_data_protection" name="privacy_data_protection" required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="cookie_policy">Cookie Policy</label>
                        <textarea id="cookie_policy" name="cookie_policy" required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="account_registration">Account Registration</label>
                        <textarea id="account_registration" name="account_registration" required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="limitation_liability">Limitation of Liability</label>
                        <textarea id="limitation_liability" name="limitation_liability" required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="governing_law">Governing Law</label>
                        <textarea id="governing_law" name="governing_law" required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="changes_terms">Changes to Terms</label>
                        <textarea id="changes_terms" name="changes_terms" required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="contact_information">Contact Information</label>
                        <textarea id="contact_information" name="contact_information" required></textarea>
                    </div>

                    <button type="submit" class="btn btn-success">Update Terms & Conditions</button>
                </form>
            </div>

            <!-- Team Members Tab -->
            <div id="team-tab" class="tab-content">
                <h2>Team Members Management</h2>
                
                <!-- Team Member Form (initially hidden) -->
                <div id="team-form-container" class="team-form" style="display: none;">
                    <h3 id="team-form-title">Add Team Member</h3>
                    <form id="team-member-form">
                        <input type="hidden" id="team-member-id">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="member_name">Name</label>
                                <input type="text" id="member_name" name="member_name" required>
                            </div>
                            <div class="form-group">
                                <label for="member_role">Role</label>
                                <input type="text" id="member_role" name="member_role" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="member_bio">Bio</label>
                            <textarea id="member_bio" name="member_bio" required></textarea>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="member_avatar">Avatar URL (optional)</label>
                                <input type="text" id="member_avatar" name="member_avatar">
                            </div>
                            <div class="form-group">
                                <label for="member_order">Display Order</label>
                                <input type="number" id="member_order" name="member_order" value="0" min="0">
                            </div>
                        </div>
                        <button type="submit" class="btn btn-success" id="team-form-submit">Add Team Member</button>
                        <button type="button" class="btn btn-secondary" id="cancel-team-form">Cancel</button>
                    </form>
                </div>

                <!-- Team Members List -->
                <div id="team-members-list">
                    <!-- Team members will be loaded here -->
                </div>
                
                <button class="btn" id="add-team-member-btn">
                    <i class="fas fa-plus"></i> Add Team Member
                </button>
            </div>
        </div>
    </div>

<script type="module">
    import { createClient } from 'https://cdn.skypack.dev/@supabase/supabase-js';
    
    const supabaseUrl = 'https://wtiqgcsucpcqgyqutcmq.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind0aXFnY3N1Y3BjcWd5cXV0Y21xIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY0MzMzNDYsImV4cCI6MjA2MjAwOTM0Nn0.MtXBQ9qXTPwWEBh8l5jYh_zDYKkYyiUc2WwaA5wrtpE';

    // Authentication check
    async function checkAuth() {
        const { data: { user }, error } = await supabase.auth.getUser();
        if (error || !user) {
            window.location.href = 'login.html';
            return null;
        }
        return user;
    }

    // Initialize Supabase client with error handling
    let supabase;
    try {
        supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
        console.log('Supabase client initialized');
    } catch (error) {
        console.error('Error initializing Supabase:', error);
        showStatus('Error connecting to database. Please check your Supabase configuration.', 'error');
    }

    // Show status message
    function showStatus(message, type = 'success') {
        const statusEl = document.getElementById('statusMessage');
        statusEl.textContent = message;
        statusEl.className = `status-message status-${type}`;
        statusEl.style.display = 'block';
        
        setTimeout(() => {
            statusEl.style.display = 'none';
        }, 5000);
    }

    // Tab functionality
    document.querySelectorAll('.tab-button').forEach(button => {
        button.addEventListener('click', () => {
            // Remove active class from all buttons and contents
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // Add active class to clicked button and corresponding content
            button.classList.add('active');
            document.getElementById(`${button.dataset.tab}-tab`).classList.add('active');
            
            // Reload team members when team tab is activated
            if (button.dataset.tab === 'team') {
                loadTeamMembers();
            }
        });
    });

    // Load About Us data
    async function loadAboutUs() {
        if (!supabase) {
            showStatus('Database not configured', 'error');
            return;
        }

        try {
            const { data, error } = await supabase
                .from('about_us')
                .select('*')
                .single();

            if (error) throw error;

            if (data) {
                document.getElementById('hero_title').value = data.hero_title || '';
                document.getElementById('hero_description').value = data.hero_description || '';
                document.getElementById('our_story').value = data.our_story || '';
                document.getElementById('what_we_do').value = data.what_we_do || '';
                document.getElementById('our_values').value = data.our_values || '';
                document.getElementById('contact_section').value = data.contact_section || '';
                
                if (data.stats_section) {
                    document.getElementById('stat_products').value = data.stats_section.products_available || '';
                    document.getElementById('stat_satisfaction').value = data.stats_section.customer_satisfaction || '';
                    document.getElementById('stat_delivery').value = data.stats_section.delivery_cost || '';
                    document.getElementById('stat_coverage').value = data.stats_section.delivery_coverage || '';
                }
            }
        } catch (error) {
            console.error('Error loading about us:', error);
            showStatus('Error loading About Us data', 'error');
        }
    }

    // Update About Us
    document.getElementById('about-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        if (!supabase) {
            showStatus('Database not configured', 'error');
            return;
        }

        const formData = {
            hero_title: document.getElementById('hero_title').value,
            hero_description: document.getElementById('hero_description').value,
            our_story: document.getElementById('our_story').value,
            what_we_do: document.getElementById('what_we_do').value,
            our_values: document.getElementById('our_values').value,
            contact_section: document.getElementById('contact_section').value,
            stats_section: {
                products_available: document.getElementById('stat_products').value,
                customer_satisfaction: document.getElementById('stat_satisfaction').value,
                delivery_cost: document.getElementById('stat_delivery').value,
                delivery_coverage: document.getElementById('stat_coverage').value
            },
            updated_at: new Date().toISOString()
        };

        try {
            // First get the ID of the existing record
            const { data: existingData, error: fetchError } = await supabase
                .from('about_us')
                .select('id')
                .single();

            if (fetchError) throw fetchError;

            const { data, error } = await supabase
                .from('about_us')
                .update(formData)
                .eq('id', existingData.id);

            if (error) throw error;
            
            showStatus('About Us updated successfully!');
        } catch (error) {
            console.error('Error updating about us:', error);
            showStatus('Error updating About Us', 'error');
        }
    });

    // Load Terms & Conditions
    async function loadTerms() {
        if (!supabase) {
            showStatus('Database not configured', 'error');
            return;
        }

        try {
            const { data, error } = await supabase
                .from('terms_conditions')
                .select('*')
                .single();

            if (error) throw error;

            if (data) {
                document.getElementById('last_updated').value = data.last_updated || '';
                document.getElementById('introduction').value = data.introduction || '';
                document.getElementById('orders_payments').value = data.orders_payments || '';
                document.getElementById('shipping_delivery').value = data.shipping_delivery || '';
                document.getElementById('returns_refunds').value = data.returns_refunds || '';
                document.getElementById('non_returnable_items').value = data.non_returnable_items || '';
                document.getElementById('exchanges').value = data.exchanges || '';
                document.getElementById('privacy_data_protection').value = data.privacy_data_protection || '';
                document.getElementById('cookie_policy').value = data.cookie_policy || '';
                document.getElementById('account_registration').value = data.account_registration || '';
                document.getElementById('limitation_liability').value = data.limitation_liability || '';
                document.getElementById('governing_law').value = data.governing_law || '';
                document.getElementById('changes_terms').value = data.changes_terms || '';
                document.getElementById('contact_information').value = data.contact_information || '';
            }
        } catch (error) {
            console.error('Error loading terms:', error);
            showStatus('Error loading Terms & Conditions', 'error');
        }
    }

    // Update Terms & Conditions
    document.getElementById('terms-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        if (!supabase) {
            showStatus('Database not configured', 'error');
            return;
        }

        const formData = {
            last_updated: document.getElementById('last_updated').value,
            introduction: document.getElementById('introduction').value,
            orders_payments: document.getElementById('orders_payments').value,
            shipping_delivery: document.getElementById('shipping_delivery').value,
            returns_refunds: document.getElementById('returns_refunds').value,
            non_returnable_items: document.getElementById('non_returnable_items').value,
            exchanges: document.getElementById('exchanges').value,
            privacy_data_protection: document.getElementById('privacy_data_protection').value,
            cookie_policy: document.getElementById('cookie_policy').value,
            account_registration: document.getElementById('account_registration').value,
            limitation_liability: document.getElementById('limitation_liability').value,
            governing_law: document.getElementById('governing_law').value,
            changes_terms: document.getElementById('changes_terms').value,
            contact_information: document.getElementById('contact_information').value,
            updated_at: new Date().toISOString()
        };

        try {
            // First get the ID of the existing record
            const { data: existingData, error: fetchError } = await supabase
                .from('terms_conditions')
                .select('id')
                .single();

            if (fetchError) throw fetchError;

            const { data, error } = await supabase
                .from('terms_conditions')
                .update(formData)
                .eq('id', existingData.id);

            if (error) throw error;
            
            showStatus('Terms & Conditions updated successfully!');
        } catch (error) {
            console.error('Error updating terms:', error);
            showStatus('Error updating Terms & Conditions', 'error');
        }
    });

    // TEAM MEMBER FUNCTIONS

    // Load team members
    async function loadTeamMembers() {
        if (!supabase) {
            showStatus('Database not configured', 'error');
            return;
        }

        try {
            const { data, error } = await supabase
                .from('team_members')
                .select('*')
                .order('display_order');

            if (error) throw error;

            const teamList = document.getElementById('team-members-list');
            teamList.innerHTML = '';

            if (data.length === 0) {
                teamList.innerHTML = '<p>No team members found. Click "Add Team Member" to get started.</p>';
                return;
            }

            data.forEach(member => {
                const memberEl = document.createElement('div');
                memberEl.className = 'team-member';
                memberEl.innerHTML = `
                    <h4>${member.name}</h4>
                    <p><strong>Role:</strong> ${member.role}</p>
                    <p><strong>Bio:</strong> ${member.bio}</p>
                    ${member.avatar_url ? `<p><strong>Avatar:</strong> ${member.avatar_url}</p>` : ''}
                    <p><strong>Display Order:</strong> ${member.display_order}</p>
                    <div class="team-member-actions">
                        <button class="btn edit-team-btn" data-id="${member.id}">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="btn btn-danger delete-team-btn" data-id="${member.id}">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                `;
                teamList.appendChild(memberEl);
            });

            // Add event listeners to the new buttons
            document.querySelectorAll('.edit-team-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = e.target.closest('.edit-team-btn').getAttribute('data-id');
                    editTeamMember(id);
                });
            });

            document.querySelectorAll('.delete-team-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = e.target.closest('.delete-team-btn').getAttribute('data-id');
                    deleteTeamMember(id);
                });
            });

        } catch (error) {
            console.error('Error loading team members:', error);
            showStatus('Error loading team members', 'error');
        }
    }

    // Show add team member form
    function showAddTeamMemberForm() {
        document.getElementById('team-form-title').textContent = 'Add Team Member';
        document.getElementById('team-member-form').reset();
        document.getElementById('team-member-id').value = '';
        document.getElementById('team-form-submit').textContent = 'Add Team Member';
        document.getElementById('team-form-container').style.display = 'block';
        
        // Scroll to form
        document.getElementById('team-form-container').scrollIntoView({ behavior: 'smooth' });
    }

    // Cancel team member form
    function cancelTeamMemberForm() {
        document.getElementById('team-form-container').style.display = 'none';
        document.getElementById('team-member-form').reset();
    }

    // Edit team member
    async function editTeamMember(id) {
        if (!supabase) {
            showStatus('Database not configured', 'error');
            return;
        }

        try {
            const { data, error } = await supabase
                .from('team_members')
                .select('*')
                .eq('id', id)
                .single();

            if (error) throw error;

            if (data) {
                document.getElementById('team-form-title').textContent = 'Edit Team Member';
                document.getElementById('team-member-id').value = data.id;
                document.getElementById('member_name').value = data.name;
                document.getElementById('member_role').value = data.role;
                document.getElementById('member_bio').value = data.bio;
                document.getElementById('member_avatar').value = data.avatar_url || '';
                document.getElementById('member_order').value = data.display_order;
                document.getElementById('team-form-submit').textContent = 'Update Team Member';
                document.getElementById('team-form-container').style.display = 'block';
                
                // Scroll to form
                document.getElementById('team-form-container').scrollIntoView({ behavior: 'smooth' });
            }
        } catch (error) {
            console.error('Error loading team member:', error);
            showStatus('Error loading team member data', 'error');
        }
    }

    // Delete team member
    async function deleteTeamMember(id) {
        if (!supabase) {
            showStatus('Database not configured', 'error');
            return;
        }

        if (!confirm('Are you sure you want to delete this team member?')) {
            return;
        }

        try {
            const { error } = await supabase
                .from('team_members')
                .delete()
                .eq('id', id);

            if (error) throw error;
            
            showStatus('Team member deleted successfully!');
            loadTeamMembers(); // Reload the list
        } catch (error) {
            console.error('Error deleting team member:', error);
            showStatus('Error deleting team member', 'error');
        }
    }

    // Handle team member form submission
    document.getElementById('team-member-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        if (!supabase) {
            showStatus('Database not configured', 'error');
            return;
        }

        const memberId = document.getElementById('team-member-id').value;
        const formData = {
            name: document.getElementById('member_name').value,
            role: document.getElementById('member_role').value,
            bio: document.getElementById('member_bio').value,
            avatar_url: document.getElementById('member_avatar').value || null,
            display_order: parseInt(document.getElementById('member_order').value) || 0,
            updated_at: new Date().toISOString()
        };

        try {
            if (memberId) {
                // Update existing team member
                const { error } = await supabase
                    .from('team_members')
                    .update(formData)
                    .eq('id', memberId);

                if (error) throw error;
                showStatus('Team member updated successfully!');
            } else {
                // Add new team member
                const { error } = await supabase
                    .from('team_members')
                    .insert([formData]);

                if (error) throw error;
                showStatus('Team member added successfully!');
            }
            
            // Reset form and reload list
            cancelTeamMemberForm();
            loadTeamMembers();
        } catch (error) {
            console.error('Error saving team member:', error);
            showStatus('Error saving team member', 'error');
        }
    });

    // Initialize dashboard
    document.addEventListener('DOMContentLoaded', async () => {
        // Check authentication first
        const user = await checkAuth();
        if (!user) return;
        
        // Show content after auth check
        document.getElementById('loading-spinner').style.display = 'none';
        document.getElementById('content').style.display = 'block';

        // Set up event listeners
        document.getElementById('add-team-member-btn').addEventListener('click', showAddTeamMemberForm);
        document.getElementById('cancel-team-form').addEventListener('click', cancelTeamMemberForm);

        // Load initial data
        loadAboutUs();
        loadTerms();
        loadTeamMembers();

        console.log('Dashboard initialized successfully');
    });

    // Simple authentication
    document.getElementById('logout-btn').addEventListener('click', (e) => {
        e.preventDefault();
        if (confirm('Are you sure you want to logout?')) {
            window.location.href = 'login.html';
        }
    });

    // Make functions globally available
    window.showAddTeamMemberForm = showAddTeamMemberForm;
    window.editTeamMember = editTeamMember;
    window.deleteTeamMember = deleteTeamMember;
    window.cancelTeamMemberForm = cancelTeamMemberForm;
</script>
</body>
</html>